<story-context id="arda-core/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1</storyId>
    <title>Project Setup and Repository Initialization</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-11-14</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>bmad-docs/sprint-artifacts/1-1-project-setup-and-repository-initialization.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>initialize the Arda project repository with proper structure and tooling</iWant>
    <soThat>begin building features in an organized, reproducible environment</soThat>
    <tasks>4 main tasks: (1) Create repository structure, (2) Create GitHub repository, (3) Configure pre-commit hooks, (4) Create development documentation</tasks>
  </story>

  <acceptanceCriteria>
    1. Repository contains proper directory structure (pkgs/arda-cli/, modules/nixos/, templates/, hosts/, lib/)
    2. GitHub repository is created with initial commit at https://github.com/lorddevi/arda-core
    3. Git hooks and pre-commit checks are configured for secrets detection and code formatting
    4. Development documentation explains the project structure and branch strategy
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>bmad-docs/PRD.md</path>
        <title>Product Requirements Document - Arda</title>
        <section>Installation & Setup Success</section>
        <snippet>User can complete initial Arda installation in under 1 hour from clone to running configuration. No manual NixOS configuration knowledge required beyond basic terminal familiarity.</snippet>
      </doc>
      <doc>
        <path>bmad-docs/architecture.md</path>
        <title>Architecture: Arda</title>
        <section>Project Structure</section>
        <snippet>Repository structure follows Arda architecture with pkgs/arda-cli/, modules/nixos/, templates/, hosts/, lib/ directories. Clear separation of concerns for CLI tool, NixOS modules, templates, and configurations.</snippet>
      </doc>
      <doc>
        <path>bmad-docs/architecture.md</path>
        <title>Architecture: Arda</title>
        <section>ADR-006: Package Structure</section>
        <snippet>Use pkgs/arda-cli/ directory structure matching clan's approach. Clean future expansion, familiar structure to clan users, standard flake module integration.</snippet>
      </doc>
      <doc>
        <path>bmad-docs/epics.md</path>
        <title>clan-core - Epic Breakdown</title>
        <section>Epic 1: Foundation & Development Environment</section>
        <snippet>Establish essential development infrastructure including development shell, branch management, and core tooling needed to build and test all other features.</snippet>
      </doc>
      <doc>
        <path>bmad-docs/epics.md</path>
        <title>clan-core - Epic Breakdown</title>
        <section>Story 1.1: Project Setup and Repository Initialization</section>
        <snippet>Initialize repository with proper directory structure and tooling. Create GitHub repo, configure branch strategy, set up pre-commit checks, and document project structure.</snippet>
      </doc>
      <doc>
        <path>bmad-docs/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Foundation & Development Environment</title>
        <section>Non-Functional Requirements - Security</section>
        <snippet>Private repository with controlled access. Git hooks for secret detection. Dependency pinning via flake.lock. Age keys and .sops.yaml protected with proper permissions.</snippet>
      </doc>
    </docs>

    <code>
      <!-- No existing code - this is the first story and repository initialization -->
      <!-- Repository structure will be created by this story -->
      <note>No existing code artifacts - this is initial repository setup</note>
    </code>

    <dependencies>
      <ecosystem>nix>
        <package>nixpkgs</package>
        <version>pinned via flake</version>
      </ecosystem>
      <ecosystem>nix>
        <package>flake-utils</package>
        <version>^1.0.0</version>
      </ecosystem>
      <ecosystem>python>
        <package>python</package>
        <version>3.13+</version>
      </ecosystem>
      <ecosystem>python>
        <package>pytest</package>
        <version>^7.0.0</version>
      </ecosystem>
      <ecosystem>python>
        <package>black</package>
        <version>^23.0.0</version>
      </ecosystem>
      <ecosystem>python>
        <package>flake8</package>
        <version>^6.0.0</version>
      </ecosystem>
      <ecosystem>
        <package>git</package>
        <version>latest</version>
      </ecosystem>
      <ecosystem>
        <package>gh (GitHub CLI)</package>
        <version>^2.0.0</version>
      </ecosystem>
      <ecosystem>
        <package>age</package>
        <version>latest</version>
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    Repository must be private with controlled access per security requirements. Branch strategy must follow main (arda-v1) as primary development branch with clan-core as reference. Pre-commit hooks must include secret detection (critical for Epic 6: Secret Management). Directory structure must align with Service/Feature/Role hierarchy. Repository should support minimal subset extraction from clan-core.
  </constraints>

  <interfaces>
    <interface>
      <name>Repository Structure</name>
      <kind>Directory structure and organization</kind>
      <signature>pkgs/arda-cli/, modules/nixos/, templates/, hosts/, lib/</signature>
      <path>bmad-docs/architecture.md#Project-Structure</path>
    </interface>
    <interface>
      <name>Branch Management</name>
      <kind>Git workflow conventions</kind>
      <signature>main (arda-v1), clan-core (reference), feature/*, bugfix/*, experiment/*</signature>
      <path>bmad-docs/architecture.md#Development-Environment</path>
    </interface>
    <interface>
      <name>Pre-commit Hooks</name>
      <kind>Git hooks configuration</kind>
      <signature>Secret detection, code formatting (black, flake8)</signature>
      <path>bmad-docs/PRD.md#Installation--Setup-Success</path>
    </interface>
  </interfaces>

  <tests>
    <standards>Testing framework setup (pytest) with code coverage reporting. All code must follow Python formatting standards (black, flake8). Tests should validate repository structure creation and Git hook configuration.</standards>
    <locations>tests/ directory structure to be created with this story</locations>
    <ideas>
      <test>
        <id>AC1</id>
        <description>Validate repository directory structure exists with all required directories</description>
      </test>
      <test>
        <id>AC2</id>
        <description>Verify GitHub repository can be created and accessed</description>
      </test>
      <test>
        <id>AC3</id>
        <description>Test pre-commit hooks are installed and functional (secrets detection, code formatting)</description>
      </test>
      <test>
        <id>AC4</id>
        <description>Verify README.md and CONTRIBUTING.md exist with proper documentation</description>
      </test>
    </ideas>
  </tests>
</story-context>
